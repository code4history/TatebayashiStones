# TatebayashiStones
「たてばやしの野仏巡り」全5巻相当のデータのオープンデータ化＆現況調査プロジェクト

## 更新環境の整備

本リポジトリをgitでcloneし、作業PC上にダウンロードしてください。  
ダウンロードしたファイル構造の中に`bin`フォルダがあるので、そこに管理用プログラムを設置します。  
管理用プログラムとしては[Torii](https://github.com/code4history/Torii)というプログラムを用いますが、左記のリンクからアクセスし、ご利用のPCのOSにあわせた実行ファイルの含まれたzipファイルを取得してください。  
zipファイルのファイル名は、`torii_[OS名]_[バージョン].zip`のようになっています。  
zipを展開すると、`qgis2Xlsx_[OS名]`と`xlsx2Qgis_[OS名]`で始まる、各OS用の実行ファイルが含まれているので、これを先述の`bin`フォルダの下に配置すれば、管理環境の構築は完了です。  
(なお、これらの実行ファイルの初回実行時は、怪しい実行ファイルを実行してよいかの注意が出る可能性がありますが、こちらは実行することを許可してください。将来的に、注意を出さないような施策を打ちたいとは考えていますが、現状は初回に注意が出てしまいます。)

## データ構成

### データマスタで管理されている情報

データマスタとしては、Excelファイル(`tatebayashi_stones.xlsx`)もしくはGeoJSONファイル(`pois.geojson`、`books.geojson`、`refs.geojson`、`images.geojson`)のどちらかで管理されますが、どちらでも管理している情報は同じです。  
4つのテーブルが、Excelでは異なるワークシート、GeoJSONではテーブル毎に異なるファイルで管理されます。

#### pois (石造物地物の基本情報)

|属性名(GeoJSON)|属性名(Excel)|データ種別|備考|
|----|----|----|----|
|fid|ID|数値|昇順、項目削除などで飛びが生じてもよいが一度つけると変更厳禁|
|name|名称|文字列| |
|type|種別|文字列|"地蔵菩薩像","如来像","馬頭観世音","庚申","道標"など、取り得る値は他のデータを参考にしてください<br>庚申兼道標など、コンマで区切って複数の値を認めます|
|era|和暦|文字列|和暦の年号を記載します<br>天保年間などあいまいな記載でも大丈夫です|
|year|年|文字列|西暦での年を指定しますが、あいまいな和暦に対応するため、空や複数記載でも構いません(そのため数値ではなく文字列になっています)|
|area|地域|文字列|館林内での地域"館林","赤羽","郷谷","六郷","渡瀬","多々良","三野谷"のいずれかを採ります|
|oaza|大字|文字列|現在の町丁目名を指定します|
|koaza|小字|文字列|町丁目内での小字が分かっていれば記載します|
|detail_place|詳細場所|文字列|寺社や公民館、あるいは交差点、○○氏宅など所在地情報がわかっていれば記載します<br>番地情報などは元本にあっても経緯度で表現するので削除します|
|reference_memo|参照本情報|文字列|参照本に記載されている情報で、形状やサイズなど他に項目がない内容をここに書きます(向いている向きなど)|
|folklore|言い伝え|文字列|参照本などに記載されている情報で、言い伝えに類するもの(詣でれば虫歯が直る、他)を記載する|
|history|歴史|文字列|参照本などに記載されている情報で、歴史、来歴に類するものを記載する|
|survey_memo|調査情報|文字列|実際の調査の際に判明した情報を記載する|
|surveyed|調査日|文字列|最新の調査が実施された年月日|
|confirmed|現況調査済み|Boolean|一度でも調査がなされればTRUEとする|
|primary_image|優先画像ID|数値|`images`テーブルで管理されている関連画像の内、表示を最優先する画像のfidを指定する|
|height|総高|数値|石造物の総高、cmで|
|statue_height|像高|数値|石造物の像など主要部分の高さ、cmで|
|width|幅|数値|石造物の幅、cmで|
|depth|厚さ|数値|石造物の厚さ、cmで|
|shape|形状|文字列|形状に関する情報|
|material|材質|文字列|石造、木造、銅造など材質情報|
|inscription|刻銘|文字列|刻銘の記載内容|
|color|色|文字列|彩色されている場合などの色情報|
|contradiction|データの矛盾|文字列|言及されている複数の本同士の記載の矛盾や、記載内容と調査の矛盾など、今後再調査などで解決すべき矛盾|
|need_action|要対応|文字列|地物をGoogle StreetViewで見つけた場合など、データの矛盾ではないが今後追加調査が必要な場合、その内容を記載|
|status|状況|文字列|"新規発見""消失?"など、状況を表す文字列|
|longitude|経度|数値|経度|
|latitude|緯度|数値|緯度|

#### books (石造物について記載のある本のマスタ)

|属性名(GeoJSON)|属性名(Excel)|データ種別|備考|
|----|----|----|----|
|fid|ID|数値|昇順、項目削除などで飛びが生じてもよいが一度つけると変更厳禁|
|name|書籍名|数値|書籍の名称を記載|
|editor|著者|文字列|著者、編者等を記載|
|published_at|出版年|文字列|出版年を記載、雑誌の場合はmonthly等の発行間隔を指定|
|reference_type|参照タイプ|文字列|`refs`テーブルで記載場所を指定する形式、"page"の場合ページ指定、"journal"の場合雑誌なので発行年月など指定|

#### refs (地物と本の関係性と記載ページの管理)

|属性名(GeoJSON)|属性名(Excel)|データ種別|備考|
|----|----|----|----|
|fid|ID|数値|昇順、項目削除などで飛びが生じてもよいが一度つけると変更厳禁|
|book|書籍ID|数値|関連する`books`テーブルのfid|
|poi|石造物ID|文字列|関連する`pois`テーブルのfid|
|description|説明|文字列|記載に関する説明文|
|note|ノート|文字列|記載に関する備考|
|pages|参照ページ|文字列|記載場所を指定する形式、ページ指定や雑誌の場合発行年月など|

#### images (画像ファイルの管理)

|属性名(GeoJSON)|属性名(Excel)|データ種別|備考|
|----|----|----|----|
|fid|ID|数値|昇順、項目削除などで飛びが生じてもよいが一度つけると変更厳禁|
|poi|石造物ID|数値|関連する`pois`テーブルのfid|
|path|画像パス|文字列|元画像の格納位置の相対パス|
|shooting_date|撮影日|文字列|画像の取得年月日時刻|
|shooter|撮影者|文字列|画像の撮影者|
|description|説明|文字列|画像に関する説明文|
|note|ノート|文字列|画像に関する備考|
|mid_thumbnail|中サイズサムネイル|文字列|中サイズサムネイルの格納位置の相対パス|
|small_thumbnail|小サイズサムネイル|文字列|小サイズサムネイルの格納位置の相対パス|

### ファイルシステムで管理されている情報

#### imagesディレクトリ


## ファイル構成と管理方法

###






### Excelで管理する場合

Excelでのデータは、`tatebayashi_stones.xlsx`を更新してください。  
Excel内には`注意` `pois` `books` `images` `refs`の5ワークシートが存在しますが、
